{% extends 'base.html' %}

{% block content %}
<h2>Create a New Post</h2>

<form method="POST" enctype="multipart/form-data">
  {% csrf_token %}
  {{ form.as_p }}

  <!-- Image upload + preview -->
  <label for="id_image"><strong>Upload Image:</strong></label>
  <input type="file" id="id_image" name="image" accept="image/*" onchange="previewImage(event)">
  <div id="imagePreview"></div>
  <div id="imageBlogView"></div>

  <!-- Audio upload + preview -->
  <label for="id_audio"><strong>Upload Audio:</strong></label>
  <input type="file" id="id_audio" name="audio" accept="audio/*" onchange="previewAudio(event)">
  <div id="audioPreview"></div>
  <div id="audioBlogView"></div>

  <button type="submit" style="margin-top: 20px;">Publish</button>
</form>

<!-- Styles -->
<style>
  #imagePreview, #audioPreview, #imageBlogView, #audioBlogView {
    margin-top: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 10px;
    background-color: #f9f9f9;
  }

  #imagePreview img,
  #imageBlogView img {
    max-width: 100%;
    height: auto;
    border-radius: 6px;
    display: block;
    margin-bottom: 5px;
  }

  #audioPreview audio,
  #audioBlogView audio {
    width: 100%;
    outline: none;
    margin-bottom: 5px;
  }

  h3.preview-title {
    margin-top: 15px;
    margin-bottom: 10px;
    color: #444;
  }
</style>

<!-- JavaScript -->
<script>
  function previewImage(event) {
    const preview = document.getElementById('imagePreview');
    const blogView = document.getElementById('imageBlogView');
    const file = event.target.files[0];

    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        // Preview for confirmation
        preview.innerHTML = `
          <h3 class="preview-title">Image Preview</h3>
          <img src="${e.target.result}" alt="Image Preview">
        `;

        // Simulated blog post view
        blogView.innerHTML = `
          <h3 class="preview-title">Blog Post Appearance</h3>
          <div style="padding: 10px; border-radius: 6px;">
            <img src="${e.target.result}" alt="Image in Blog">
            <p style="font-style: italic; color: #666;">(This is how your image will appear in the blog)</p>
          </div>
        `;
      };
      reader.readAsDataURL(file);
    } else {
      preview.innerHTML = '<p style="color: red;">Please select a valid image file.</p>';
      blogView.innerHTML = '';
    }
  }

  function previewAudio(event) {
    const preview = document.getElementById('audioPreview');
    const blogView = document.getElementById('audioBlogView');
    const file = event.target.files[0];

    if (file && file.type.startsWith('audio/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        // Preview for confirmation
        preview.innerHTML = `
          <h3 class="preview-title">Audio Preview</h3>
          <audio controls>
            <source src="${e.target.result}" type="${file.type}">
            Your browser does not support the audio element.
          </audio>
        `;

        // Simulated blog post view
        blogView.innerHTML = `
          <h3 class="preview-title">Blog Post Appearance</h3>
          <div style="padding: 10px; border-radius: 6px;">
            <audio controls>
              <source src="${e.target.result}" type="${file.type}">
              Your browser does not support the audio element.
            </audio>
            <p style="font-style: italic; color: #666;">(This is how your audio will appear in the blog)</p>
          </div>
        `;
      };
      reader.readAsDataURL(file);
    } else {
      preview.innerHTML = '<p style="color: red;">Please select a valid audio file.</p>';
      blogView.innerHTML = '';
    }
  }
</script>
{% endblock %}
